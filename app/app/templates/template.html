<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CoExPlore</title>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Bootstrap CSS (Bootstrap 5.3) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap JS Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Fancybox CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" />
  <!-- Fancybox JS -->
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script>
  <!-- Bootstrap Select CSS -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
  <!-- Bootstrap Select JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
  <!-- PapaParse Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <!-- DataTables Library -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
  <script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <!-- Custom CSS -->
  <link href="static/styles.css" rel="stylesheet">
</head>

<body>
  <div id="loadingSpinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Wrapper for Sidebar and Main Content -->
  <div id="main-container">
    <!-- Sidebar for large screens -->
    <nav id="sidebar" class="d-none d-lg-block">
      <div class="sidebar-sticky">
        <a href="#" class="navbar-brand">CoExPlore</a>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="#selectPlantsCard">Datasets</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#infoDivCard" id="settingsNavLink">Info and Settings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#browserCard" id="browserNavLink">Browser</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#downstreamCard" id="transcriptomeNavLink">Whole Transcriptome Analysis</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#finishedCard" id="sessionFilesNavLink">Session Files</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <div id="main-content">
      <div class="container-fluid my-5">
        <!-- Select Plants Card -->
        <div class="card mb-3" id="selectPlantsCard" style="display: none;">
          <div class="card-header">
            <h5 class="mb-0 d-flex justify-content-between align-items-center">
              Datasets
              <button class="btn btn-link toggle-button" data-bs-toggle="collapse" data-bs-target="#selectPlantsSection"
                aria-expanded="true">
                <span>Hide</span>
              </button>
            </h5>
          </div>
          <div id="selectPlantsSection" class="collapse show">
            <div class="card-body">
              <form id="analysisForm">
                <!-- Species Multiselect -->
                <div class="row justify-content-center">
                  <div class="col-md-8 text-center">
                    <div class="form-group">
                      <br>
                      <select class="selectpicker" id="plant" multiple data-actions-box="true" data-live-search="true"
                        data-style="btn-primary" data-width="75%">
                        {% for code, name in species %}
                        <option value="{{ code }}" {% if loop.first %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                </div>
              </form>
              <!-- Help Icon Dataset Description -->
              <div class="text-center mb-3">
                <button id="helpIconDataset" class="btn btn-link" style="font-size: 24px;">
                  <i class="bi bi-question-circle"></i>
                </button>
              </div>
              <!-- Dataset Description -->
              <div id="userGuideCardDataset" class="analysis-description" style="display: none;">
                <p>
                  The datasets have been processed using <a href="https://github.com/Mfkessler/PyWGCNA"
                    target="_blank"><strong>PyWGCNA</strong></a>
                  with the following default parameters:
                </p>
                <ul>
                  <li>Minimum Module Size: <strong>50</strong></li>
                  <li>Dissimilarity Threshold: <strong>0.2</strong></li>
                  <li>Network Type: <strong>signed hybrid</strong></li>
                  <li>Power: <strong>between 9 and 19</strong> to achieve a <strong>scale‑free network</strong></li>
                  <li>R² Cut: <strong>0.9</strong></li>
                  <li>Mean Connectivity: <strong>100</strong></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Info Card -->
        <div class="card mb-3" id="infoDivCard" style="display: none;">
          <div class="card-header">
            <h5 class="mb-0 d-flex justify-content-between align-items-center">
              Info and Settings
              <button class="btn btn-link toggle-button" data-bs-toggle="collapse" data-bs-target="#InfoSection"
                aria-expanded="true">
                <span>Hide</span>
              </button>
            </h5>
          </div>
          <div id="InfoSection" class="collapse show">
            <div class="card-body">
              <!-- Info Div Container -->
              <div id="infoDivContainer" style="position: relative;">
                <!-- Loading Bar Info -->
                <div id="loadingBarInfo" class="loading-text" style="display:none;">
                  <span id="loadingBarInfoStatusText">Loading...</span>
                </div>
                <!-- Info Div -->
                <div id="infoDiv">
                  <iframe id="infoIframe" style="width:100%; height:100%; border:none;"></iframe>
                </div>
              </div>
              <br>
              <!-- WGCNA Figures Card -->
              <div class="row justify-content-center">
                <div id="imageCategoryDiv" class="col-md-8" style="display: none;">
                  <h5 class="card-title text-center">Plots of Weighted Correlation Network Analysis</h5>
                  <!-- Form Group for the Select Dropdown -->
                  <div class="form-group">
                    <select class="form-control" id="imageCategory">
                      <option value="general">Module Trait Relationships, Eigengenes Clustering, Soft Threshold, Sample
                        Clustering</option>
                      <option value="module_barplot">Module Eigengene Bar Plots</option>
                      <option value="module_heatmap">Module Eigengene Heat Maps</option>
                    </select>
                  </div>
                  <!-- Image Div -->
                  <div id="imageDiv" class="imageDiv d-flex flex-wrap justify-content-center"></div>
                </div>
              </div>
              <!-- Settings Card using details/summary for toggle with arrow and fade‑in effect -->
              <details id="settingsCard">
                <!-- The summary element acts as the clickable header -->
                <summary class="toggle-header">Settings</summary>
                <!-- Toggle content will be hidden by default and shown on toggle -->
                <div class="toggle-content">
                  <div class="row justify-content-center mt-3">
                    <div class="col-md-4 col-lg-6">
                      <!-- Output Prefix Control -->
                      <div class="row mb-3">
                        <label for="outputPrefix" class="col-sm-4 col-form-label text-end">Output Prefix</label>
                        <div class="col-sm-8">
                          <input type="text" class="form-control" id="outputPrefix" placeholder="Enter output prefix">
                        </div>
                      </div>
                      <!-- Display in New Window Control -->
                      <div class="row mb-3">
                        <label for="displayInNewWindow" class="col-sm-4 col-form-label text-end">Display Results in New
                          Window</label>
                        <div class="col-sm-8 d-flex align-items-center">
                          <div class="form-check">
                            <input type="checkbox" class="form-check-input large-checkbox" id="displayInNewWindow">
                            <label class="form-check-label" for="displayInNewWindow"></label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </div>
        </div>

        <!-- Browser Card -->
        <div class="card mb-3" id="browserCard" style="display: none;">
          <div class="card-header">
            <h5 class="mb-0 d-flex justify-content-between align-items-center">
              Browser
              <button class="btn btn-link toggle-button" data-bs-toggle="collapse" data-bs-target="#browserSection"
                aria-expanded="true">
                <span>Hide</span>
              </button>
            </h5>
          </div>
          <div id="browserSection" class="collapse show">
            <div class="card-body">
              <!-- Help Icon Browser -->
              <div class="text-center mb-3">
                <button id="helpIconBrowser" class="btn btn-link" style="font-size: 24px;">
                  <i class="bi bi-question-circle"></i>
                </button>
              </div>
              <!-- Browser Description -->
              <div id="userGuideCardBrowser" class="analysis-description" style="display: none;">
                <p>
                  Explore data for selected plant species by searching for transcripts, orthogroups, GO terms (GO IDs),
                  or modules.
                  Separate multiple entries with commas. Examples of GO terms are
                  <a href="#" onclick="sendGoTermToIframe('GO:0009908'); event.preventDefault();">flower development
                    (GO:0009908)</a>,
                  <a href="#" onclick="sendGoTermToIframe('GO:0015979'); event.preventDefault();">photosynthesis
                    (GO:0015979)</a>, or
                  <a href="#" onclick="sendGoTermToIframe('GO:0006950'); event.preventDefault();">response to stress
                    (GO:0006950)</a>.
                  The search results are used for subsequent analyses.
                </p>
              </div>
              <!-- Browser Results Container -->
              <div id="browserResultsContainer" style="position: relative;">
                <!-- Loading Bar Browser -->
                <div id="loadingBarBrowser" class="loading-text" style="display:none;">
                  <span id="loadingBarBrowserStatusText">Loading...</span>
                </div>
                <!-- Browser Results -->
                <div id="browserResults" style="display: none;">
                  <iframe id="browserIframe" style="width:100%; border:none;" scrolling="no"></iframe>
                </div>
              </div>
              <!-- Browser analysis Card -->
              <div id="browserAnalysisCard" style="display: none;">
                <h5 class="card-title">Browser analysis</h5>
                <div id="browserAnalysisOptions">
                  <div class="row justify-content-center">
                    <div class="col-auto form-group">
                      <select class="form-control" id="browserAnalysisType">
                        {% for key, description in browser_options.items() %}
                        <option value="{{ key }}">{{ description }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <!-- Description Icon -->
                  <div class="text-center mb-3">
                    <button id="browserHelpIcon" class="btn btn-link" style="font-size: 24px;">
                      <i class="bi bi-question-circle"></i>
                    </button>
                  </div>
                  <!-- Browser Analysis Descriptions -->
                  <div id="analysisDescriptionContainer">
                    <div id="description_plot_co_expression_network" class="analysis-description"
                      style="display: none;">
                      <p>
                        The Co-Expression Network Analysis provides a view of transcript interactions using
                        precomputed TOMs. Clusters are generated automatically based on your chosen threshold, and
                        cluster–trait relationships are computed for each cluster. You can highlight specific
                        transcripts, have nodes colored by their WGCNA module assignments, and choose different
                        shapes per species.
                      </p>
                    </div>
                    <div id="description_plot_go_terms" class="analysis-description" style="display: none;">
                      <p>The Gene Ontology Enrichment Analysis calculates the enrichment of Gene Ontology (GO) terms for
                        a given set of transcripts, derived from the Browser results. The analysis uses a specified top
                        percentage of transcripts to focus on the most highly expressed transcripts. Parameters such as
                        maximum p‑value to filter significant GO terms, minimum fold enrichment, and minimum depth for
                        the GO term affect the interactive plot. Detailed results can be found in the Session Files.</p>
                    </div>
                    <div id="description_plot_venn" class="analysis-description" style="display: none;">
                      <p>The analysis takes a list of transcripts from the Browser results and generates a Venn diagram
                        to show the overlap of orthogroups between the selected species.</p>
                    </div>
                    <div id="description_plot_upset" class="analysis-description" style="display: none;">
                      <p>The analysis takes a list of transcripts from the Browser results and generates an Upset plot
                        to show the overlap of orthogroups between the selected species.</p>
                    </div>
                    <div id="description_plot_filtered_jaccard_modules" class="analysis-description"
                      style="display: none;">
                      <p>The Module Similarity Network analysis calculates the Jaccard similarity between modules of
                        different plant species based on the orthogroups within each module. It examines whether the
                        same orthogroups are present in the modules across various species. Parameters include a
                        similarity threshold, options for shapes and colors, and a minimum number of orthogroups.</p>
                    </div>
                    <div id="description_plot_filtered_jaccard_species" class="analysis-description"
                      style="display: none;">
                      <p>The Species Similarity Network analysis calculates the Jaccard similarity between different
                        plant species based on the orthogroups within each plant using the Browser results. It examines
                        whether the same orthogroups are present in various species. Options for shapes and a minimum
                        orthogroup count are available.</p>
                    </div>
                    <div id="description_not_implemented" class="analysis-description" style="display: none;">
                      <p>Not implemented</p>
                    </div>
                  </div>
                  <!-- Analysis Parameters Toggle -->
                  <div id="browserParametersToggle">
                    <details id="parametersToggle">
                      <summary class="toggle-header">Parameters</summary>
                      <div class="toggle-content">
                        <!-- Container für die Browser Analysis Controls -->
                        <div class="row justify-content-center">
                          <div class="col-md-6 col-lg-8">

                            <!-- Form Group: Select Tool (Radio Buttons) --> <!-- TODO use Cytoscape only! -->
                            <div class="row mb-3" id="plotTypeGroupBrowser" style="display: none;">
                              <label class="col-sm-4 col-form-label text-end">
                                Select Tool
                              </label>
                              <div class="col-sm-8">
                                <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="radio" name="plotType" id="plotTypePlotly"
                                    value="plotly">
                                  <label class="form-check-label" for="plotTypePlotly">Plotly</label>
                                </div>
                                <div class="form-check form-check-inline">
                                  <input class="form-check-input" type="radio" name="plotType" id="plotTypeCytoscape"
                                    value="cytoscape" checked>
                                  <label class="form-check-label" for="plotTypeCytoscape">Cytoscape</label>
                                </div>
                              </div>
                            </div>

                            <!-- Form Group: Percentage of Highest Expressed Transcripts -->
                            <div class="row mb-3" id="nTopPercentGroupBrowser" style="display: none;">
                              <label for="nTopPercentBrowser" class="col-sm-4 col-form-label text-end">
                                Percentage of Highest Expressed Transcripts
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="nTopPercentBrowser"
                                  placeholder="Enter top percentage" step="0.1" value="1.0" min="0.1" max="100"
                                  required>
                              </div>
                            </div>

                            <!-- Form Group: Top n of Highest Expressed Transcripts -->
                            <div class="row mb-3" id="nTopGroupBrowser" style="display: none;">
                              <label for="nTopBrowser" class="col-sm-4 col-form-label text-end">
                                Top n of Highest Expressed Transcripts
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="nTopBrowser" placeholder="Enter top n"
                                  step="1" value="10" min="1" required>
                              </div>
                            </div>

                            <!-- Form Group: Threshold -->
                            <div class="row mb-3" id="thresholdGroupBrowser" style="display: none;">
                              <label for="thresholdBrowser" class="col-sm-4 col-form-label text-end">
                                Threshold
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="thresholdBrowser"
                                  placeholder="Enter threshold value" step="0.05" value="0.3" min="0.0" max="1.0"
                                  required>
                              </div>
                            </div>

                            <!-- Form Group: Maximum P‑Value -->
                            <div class="row mb-3" id="maxPvalGroupBrowser" style="display: none;">
                              <label for="maxPvalBrowser" class="col-sm-4 col-form-label text-end">
                                Maximum P‑Value
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="maxPvalBrowser"
                                  placeholder="Enter max p‑value" step="0.01" value="0.05" min="0.0" max="1.0" required>
                              </div>
                            </div>

                            <!-- Form Group: Minimum Fold Enrichment -->
                            <div class="row mb-3" id="minFeGroupBrowser" style="display: none;">
                              <label for="minFeBrowser" class="col-sm-4 col-form-label text-end">
                                Minimum Fold Enrichment
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="minFeBrowser"
                                  placeholder="Enter min fold enrichment" step="0.01" value="0.2" min="0.0" max="1.0"
                                  required>
                              </div>
                            </div>

                            <!-- Form Group: Minimum Depth -->
                            <div class="row mb-3" id="minDepthGroupBrowser" style="display: none;">
                              <label for="minDepthBrowser" class="col-sm-4 col-form-label text-end">
                                Minimum Depth
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="minDepthBrowser"
                                  placeholder="Enter min depth" value="2" min="0" required>
                              </div>
                            </div>

                            <!-- Form Group: Minimum Number of Orthogroups -->
                            <div class="row mb-3" id="minOrthosGroupBrowser" style="display: none;">
                              <label for="minOrthosBrowser" class="col-sm-4 col-form-label text-end">
                                Minimum Number of Orthogroups
                              </label>
                              <div class="col-sm-8">
                                <input type="number" class="form-control" id="minOrthosBrowser"
                                  placeholder="Enter min orthogroups" value="10" min="1" required>
                              </div>
                            </div>

                            <!-- Form Group: Highlight Nodes -->
                            <div class="row mb-3" id="highlightListGroupBrowser" style="display: none;">
                              <label for="highlightListBrowser" class="col-sm-4 col-form-label text-end">
                                Highlight Nodes
                              </label>
                              <div class="col-sm-8">
                                <input type="text" class="form-control" id="highlightListBrowser"
                                  placeholder="Gene names">
                              </div>
                            </div>

                            <!-- Form Group: Use Shapes for Modules (Checkbox) -->
                            <div class="row mb-3" id="useShapesGroupBrowser" style="display: none;">
                              <label for="useShapesBrowser" class="col-sm-4 col-form-label text-end">
                                Use Shapes for Modules
                              </label>
                              <div class="col-sm-8 d-flex align-items-center">
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input large-checkbox" id="useShapesBrowser">
                                  <label class="form-check-label" for="useShapesBrowser"></label>
                                </div>
                              </div>
                            </div>

                            <!-- Form Group: Use Colors for Modules (Checkbox) -->
                            <div class="row mb-3" id="useColorsGroupBrowser" style="display: none;">
                              <label for="useColorsBrowser" class="col-sm-4 col-form-label text-end">
                                Use Colors for Modules
                              </label>
                              <div class="col-sm-8 d-flex align-items-center">
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input large-checkbox" id="useColorsBrowser">
                                  <label class="form-check-label" for="useColorsBrowser"></label>
                                </div>
                              </div>
                            </div>

                            <!-- Form Group: Plot Only (Checkbox) -->
                            <div class="row mb-3" id="plotOnlyGroupBrowser" style="display: none;">
                              <label for="plotOnlyBrowser" class="col-sm-4 col-form-label text-end">
                                Plot only
                              </label>
                              <div class="col-sm-8 d-flex align-items-center">
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input large-checkbox" id="plotOnlyBrowser">
                                  <label class="form-check-label" for="plotOnlyBrowser"></label>
                                </div>
                              </div>
                            </div>

                            <!-- Form Group: Use Shapes for Species (Checkbox) -->
                            <div class="row mb-3" id="useShapesSpeciesGroupBrowser" style="display: none;">
                              <label for="useShapesSpeciesBrowser" class="col-sm-4 col-form-label text-end">
                                Use Shapes for Species
                              </label>
                              <div class="col-sm-8 d-flex align-items-center">
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input large-checkbox"
                                    id="useShapesSpeciesBrowser">
                                  <label class="form-check-label" for="useShapesSpeciesBrowser"></label>
                                </div>
                              </div>
                            </div>

                            <!-- Form Group: Inter Species Only (Checkbox) -->
                            <div class="row mb-3" id="interSpeciesOnlyGroupBrowser" style="display: none;">
                              <label for="interSpeciesOnlyBrowser" class="col-sm-4 col-form-label text-end">
                                Inter Species Only
                              </label>
                              <div class="col-sm-8 d-flex align-items-center">
                                <div class="form-check">
                                  <input type="checkbox" class="form-check-input large-checkbox"
                                    id="interSpeciesOnlyBrowser" checked>
                                  <label class="form-check-label" for="interSpeciesOnlyBrowser"></label>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                    </details>
                  </div>
                  <br>
                  <!-- Run Browser Analysis Button -->
                  <div class="d-flex justify-content-center">
                    <button type="button" class="btn btn-primary" id="runBrowserAnalysis">Run Analysis</button>
                  </div>
                  <br>
                  <!-- Browser Analysis Results Container -->
                  <div id="browserAnalysisResultsContainer" style="position: relative;">
                    <!-- Loading Bar3 -->
                    <div id="loadingBar3" class="loading-text" style="display:none;">
                      <span id="loadingStatusText3">Loading...</span>
                    </div>
                    <!-- Loading Text -->
                    <div id="loadingText" class="loading-text" style="display: none;">
                      <span id="loadingStatusText"></span>
                    </div>
                    <!-- Browser Analysis Results -->
                    <div id="browserAnalysisResults" class="results" style="display: none;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Whole Transcriptome Card -->
        <div class="card mb-3" id="downstreamCard" style="display: none;">
          <div class="card-header">
            <h5 class="mb-0 d-flex justify-content-between align-items-center">
              Whole Transcriptome Analysis
              <button class="btn btn-link toggle-button" data-bs-toggle="collapse" data-bs-target="#downstreamSection"
                aria-expanded="true">
                <span>Hide</span>
              </button>
            </h5>
          </div>
          <div id="downstreamSection" class="collapse show">
            <div class="card-body">
              <h3 class="card-title"></h3>
              <div id="analysisOptions">
                <div class="row justify-content-center">
                  <div class="col-auto form-group">
                    <select class="form-control" id="analysisType">
                      {% for key, description in analysis_options.items() %}
                      <option value="{{ key }}">{{ description }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <!-- Description Icon -->
                <div class="text-center mb-3">
                  <button id="generalHelpIcon" class="btn btn-link" style="font-size: 24px;">
                    <i class="bi bi-question-circle"></i>
                  </button>
                </div>
                <!-- Analysis Descriptions -->
                <div id="analysisDescriptionContainer">
                  <!-- Single Analyses -->
                  <div id="description_plot_module_props" class="general-analysis-description" style="display: none;">
                    <p>The Transcripts per Module analysis provides an overview of all transcripts, displaying the
                      relative share of transcripts in each module using bar plots.</p>
                  </div>
                  <div id="description_plot_module_orthos" class="general-analysis-description" style="display: none;">
                    <p>The Orthogroups per Module analysis shows a bar plot with the number of unique ortholog groups
                      and total transcripts per module.</p>
                  </div>
                  <div id="description_plot_module_hubs" class="general-analysis-description" style="display: none;">
                    <p>The Top Hub Transcripts per Module analysis generates a bar plot for each module showing
                      connectivity and mean counts of the top hub transcripts.</p>
                  </div>
                  <div id="description_plot_module_goea" class="general-analysis-description" style="display: none;">
                    <p>The GOEA of each Module analysis performs Gene Ontology Enrichment Analysis per module, using a
                      specified top percentage of transcripts. Detailed tree representations are available in the
                      Session Files.</p>
                  </div>
                  <div id="description_plot_correlation_network" class="general-analysis-description"
                    style="display: none;">
                    <p>The Module Eigengenes Correlation Network analysis calculates correlations between module
                      eigengenes across samples and displays the resulting network.</p>
                  </div>
                  <!-- Multiple Analyses -->
                  <div id="description_plot_jaccard_tissues" class="general-analysis-description"
                    style="display: none;">
                    <p>The Tissues Similarity Network analysis calculates the Jaccard similarity between tissues of
                      different species based on top expressed orthogroups.</p>
                  </div>
                  <div id="description_plot_tissues_corr" class="general-analysis-description" style="display: none;">
                    <p>The Tissues Similarity Heatmap analysis visualizes the similarity of tissue expression profiles
                      as a heatmap based on top expressed orthogroups.</p>
                  </div>
                  <div id="description_plot_jaccard_modules" class="general-analysis-description"
                    style="display: none;">
                    <p>The Module Similarity Network analysis calculates the Jaccard similarity between modules across
                      species, using options for shapes, colors, and inter‑species focus.</p>
                  </div>
                  <div id="description_plot_modules_corr" class="general-analysis-description" style="display: none;">
                    <p>The Module Similarity Heatmap analysis visualizes the similarity between modules across species
                      as a heatmap.</p>
                  </div>
                  <div id="description_plot_species_correlation_network" class="general-analysis-description"
                    style="display: none;">
                    <p>The Module Membership Correlation Network analysis compares modules across species based on
                      correlations of module memberships. Parameters include a correlation threshold, p‑value, and
                      visualization options.</p>
                  </div>
                  <div id="description_plot_hog_level" class="general-analysis-description" style="display: none;">
                    <p>The HOGs Level Distribution analysis visualizes the levels of Hierarchical Orthologous Groups for
                      each species and their commonalities.</p>
                  </div>
                </div>
                <!-- Analysis Parameters Toggle -->
                <div id="wholeParametersToggle">
                  <details id="parametersToggle">
                    <summary class="toggle-header">Parameters</summary>
                    <div class="toggle-content">
                      <!-- Whole Analysis Controls using Bootstrap Grid -->
                      <div class="row justify-content-center mt-3">
                        <div class="col-md-6 col-lg-8">
                          <!-- Percentage of Highest Expressed Transcripts -->
                          <div class="row mb-3" id="nTopPercentGroup" style="display: none;">
                            <label for="nTopPercent" class="col-sm-4 col-form-label text-end">
                              Percentage of Highest Expressed Transcripts
                            </label>
                            <div class="col-sm-8">
                              <input type="number" class="form-control" id="nTopPercent"
                                placeholder="Enter top percentage" step="0.1" value="1.0" min="0.1" max="100" required>
                            </div>
                          </div>
                          <!-- Top n of Highest Expressed Transcripts -->
                          <div class="row mb-3" id="nTopGroup" style="display: none;">
                            <label for="nTop" class="col-sm-4 col-form-label text-end">
                              Top n of Highest Expressed Transcripts
                            </label>
                            <div class="col-sm-8">
                              <input type="number" class="form-control" id="nTop" placeholder="Enter top n" step="1"
                                value="10" min="1" required>
                            </div>
                          </div>
                          <!-- Threshold -->
                          <div class="row mb-3" id="thresholdGroup" style="display: none;">
                            <label for="threshold" class="col-sm-4 col-form-label text-end">
                              Threshold
                            </label>
                            <div class="col-sm-8">
                              <input type="number" class="form-control" id="threshold"
                                placeholder="Enter threshold value" step="0.01" value="0.1" min="0.0" max="1.0"
                                required>
                            </div>
                          </div>
                          <!-- Maximum P‑Value -->
                          <div class="row mb-3" id="maxPvalGroup" style="display: none;">
                            <label for="maxPval" class="col-sm-4 col-form-label text-end">
                              Maximum P‑Value
                            </label>
                            <div class="col-sm-8">
                              <input type="number" class="form-control" id="maxPval" placeholder="Enter max p‑value"
                                step="0.01" value="0.05" min="0.0" max="1.0" required>
                            </div>
                          </div>
                          <!-- Minimum Fold Enrichment -->
                          <div class="row mb-3" id="minFeGroup" style="display: none;">
                            <label for="minFe" class="col-sm-4 col-form-label text-end">
                              Minimum Fold Enrichment
                            </label>
                            <div class="col-sm-8">
                              <input type="number" class="form-control" id="minFe"
                                placeholder="Enter min fold enrichment" step="0.01" value="0.2" min="0.0" max="1.0"
                                required>
                            </div>
                          </div>
                          <!-- Minimum Depth -->
                          <div class="row mb-3" id="minDepthGroup" style="display: none;">
                            <label for="minDepth" class="col-sm-4 col-form-label text-end">
                              Minimum Depth
                            </label>
                            <div class="col-sm-8">
                              <input type="number" class="form-control" id="minDepth" placeholder="Enter min depth"
                                value="2" min="0" required>
                            </div>
                          </div>
                          <!-- Positive Correlation -->
                          <div class="row mb-3" id="positiveGroup" style="display: none;">
                            <label for="positive" class="col-sm-4 col-form-label text-end">
                              Positive Correlation
                            </label>
                            <div class="col-sm-8 d-flex align-items-center">
                              <div class="form-check">
                                <input type="checkbox" class="form-check-input large-checkbox" id="positive" checked>
                                <label class="form-check-label" for="positive"></label>
                              </div>
                            </div>
                          </div>
                          <!-- Use Shapes for Species -->
                          <div class="row mb-3" id="useShapesGroup" style="display: none;">
                            <label for="useShapes" class="col-sm-4 col-form-label text-end" id="useShapesLabel">
                              Use Shapes for Species
                            </label>
                            <div class="col-sm-8 d-flex align-items-center">
                              <div class="form-check">
                                <input type="checkbox" class="form-check-input large-checkbox" id="useShapes">
                                <label class="form-check-label" for="useShapes"></label>
                              </div>
                            </div>
                          </div>
                          <!-- Use Colors for Modules -->
                          <div class="row mb-3" id="useColorsGroup" style="display: none;">
                            <label for="useColors" class="col-sm-4 col-form-label text-end">
                              Use Colors for Modules
                            </label>
                            <div class="col-sm-8 d-flex align-items-center">
                              <div class="form-check">
                                <input type="checkbox" class="form-check-input large-checkbox" id="useColors">
                                <label class="form-check-label" for="useColors"></label>
                              </div>
                            </div>
                          </div>
                          <!-- Inter Species Only -->
                          <div class="row mb-3" id="interSpeciesOnlyGroup" style="display: none;">
                            <label for="interSpeciesOnly" class="col-sm-4 col-form-label text-end">
                              Inter Species Only
                            </label>
                            <div class="col-sm-8 d-flex align-items-center">
                              <div class="form-check">
                                <input type="checkbox" class="form-check-input large-checkbox" id="interSpeciesOnly"
                                  checked>
                                <label class="form-check-label" for="interSpeciesOnly"></label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </details>
                </div>
                <br>
                <!-- Run Analysis Button -->
                <div class="d-flex justify-content-center">
                  <button type="button" class="btn btn-primary" id="runAnalysis">Run Analysis</button>
                </div>
                <br>
                <!-- Results Container -->
                <div id="resultsContainer" style="position: relative;">
                  <!-- Loading Bar4 -->
                  <div id="loadingBar4" class="loading-text" style="display:none;">
                    <span id="loadingStatusText4">Loading...</span>
                  </div>
                  <!-- Results -->
                  <div id="results" class="results" style="display: none;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Finished Analysis Card -->
        <div class="card mb-3" id="finishedCard" style="display: none;">
          <div class="card-header">
            <h5 class="mb-0 d-flex justify-content-between align-items-center">
              Session Files
              <button class="btn btn-link toggle-button" data-bs-toggle="collapse" data-bs-target="#finishedSection"
                aria-expanded="true">
                <span>Show</span>
              </button>
            </h5>
          </div>
          <div id="finishedSection" class="collapse show">
            <div class="card-body">
              <h3 class="card-title"></h3>
              <div class="row justify-content-center">
                <div class="col-auto form-group">
                  <select class="form-control" id="fileTypeSelect">
                    <option value="all">All Results</option>
                  </select>
                </div>
              </div>
              <div id="filesDiv" class="results">
                <div class="card-body">
                  <div class="row justify-content-center mt-3">
                    <div class="col-md-6 col-lg-8">
                      <ul id="analysisList" class="list-group"></ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="button-container">
                <button type="button" class="btn btn-primary" id="downloadResultsButton">Download</button>
                <button type="button" class="btn btn-primary" id="clearFilesButton">Clear</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navbar for small screens -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light d-lg-none fixed-top">
    <a href="#" class="navbar-brand">CoExPlore</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavSmall"
      aria-controls="navbarNavSmall" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavSmall">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#selectPlantsCard">Datasets</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#infoDivCard" id="settingsNavLink">Info and Settings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#browserCard" id="browserNavLink">Browser</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#downstreamCard" id="transcriptomeNavLink">Whole Transcriptome Analysis</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#finishedCard" id="sessionFilesNavLink">Session Files</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Custom scripts -->
  <script>
    const BASE_URL = "{{ BASE_URL }}";
    const OUTPUT_DIR = "{{ OUTPUT_DIR }}";
  </script>
  <script src="static/scripts.js"></script>
</body>

</html>